## CVE Search Docker

### Options for running the app

#### As an Docker app (not yet supported)

This is an experimental feature.

To enable experimental features in the Docker CLI, edit the config.json  
file and set experimental to enabled.

You need at least one Docker node operating in Swarm mode.

The containerized version of cve-search will be provided as a docker  
app ( [docker app docs](https://docs.docker.com/app/working-with-app/) )

In order to use the docker app commands you should install an additional
plugin, check the [install guide](https://github.com/docker/app#installation)
for the installation steps.

#### Straight from the repo source using docker-compose

##### General

In the root of this repo there is a docker-compose.yml file that can be used
to build and run the required containers for CVE Search.

You will need to [install docker-compose](https://docs.docker.com/compose/install/)
in order to perform this option.

Simply clone the repo, move into the root of the cloned repo and run the command:
~~~
docker-compose up 
~~~

The first time the mongodb container is started the database will be populated
from the mongodb dump. This might take a minute or two. During the population
the webinterface might have difficulty establishing connection to the mongodb.
Once done populating the connection should be restored automatically and the  
webserver should function normally.

The mongo and redis containers are configured to persist their data to the hosts'
file system; a .cve_search_data folder will be created when the containers are started.

The cve_search instance should be available under https://localhost

##### Windows specific

open powershell as administrator:
~~~
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all
reboot
~~~

[install](https://desktop.docker.com/win/edge/Docker%20Desktop%20Installer.exe) docker for desktop windows (edge version)

[install](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi) wsl_update_x64.msi

open powershell as administrator:
~~~
wsl --set-default-version 2
~~~

[install](https://git-scm.com/download/win) git for windows. 


open git bash and clone the repo:
~~~
url=https://github.com/cve-search/CVE-Search-Docker.git
dir=$USERPROFILE'\source\repos\'"$(cut -d'/' -f3 <<<$url)"'\'"$(cut -d'/' -f4 <<<$url)"

mkdir -p "$dir" && cd "$dir" && git clone $url && cd "$dir"/CVE-Search-Docker

docker-compose up
~~~

The cve_search instance should be available under https://localhost

### Included in this repo

 - Mongodb database dump exported via the `docker/files/mongodb/data_dump_compress.sh` script;
 - Redis db dump of the Redis CPE db;

### Updating

When a new update is pulled from the repo it is recommended to 
- remove the .cve_search_data folder;
- rebuild the docker images completely.